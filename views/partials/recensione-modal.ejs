<div class="modal fade" id="recensioneModal" tabindex="-1" aria-labelledby="recensioneModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="recensioneModalLabel">
          <%= typeof recensione !== 'undefined' && recensione ? 'La tua recensione' : 'Scrivi una recensione' %>
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <% if (typeof recensione !== 'undefined' && recensione) { %>
          <!-- Se l'utente ha già una recensione, mostrarla (senza possibilità di modifica) -->
          <div class="mb-3">
            <label class="form-label">Il tuo commento:</label>
            <div class="border p-3 rounded bg-light"><%= recensione.commento %></div>
          </div>
          <div class="small text-muted mb-3">
            Recensione inserita il <%= recensione.dataFormattata %>
          </div>
        <% } else { %>
          <!-- Se non c'è ancora una recensione, mostra il form per crearne una -->
          <form id="recensioneForm" action="/recensioni/nuova" method="POST">
            <div class="mb-3">
              <label for="commento" class="form-label">Il tuo commento</label>
              <textarea class="form-control" id="commento" name="commento" rows="5" required 
                placeholder="Condividi la tua esperienza con NutriPlan..."></textarea>
            </div>
          </form>
        <% } %>
      </div>
      <div class="modal-footer">
        <% if (typeof recensione !== 'undefined' && recensione) { %>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Chiudi</button>
          <form action="/recensioni/cancella" method="POST" class="d-inline">
            <input type="hidden" name="recensioneId" value="<%= recensione.id %>">
            <button type="submit" class="btn btn-danger">
              <i class="fas fa-trash me-1"></i> Elimina recensione
            </button>
          </form>
        <% } else { %>
          <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Annulla</button>
          <button type="submit" form="recensioneForm" class="btn btn-primary">Pubblica recensione</button>
        <% } %>
      </div>
    </div>
  </div>
</div>
